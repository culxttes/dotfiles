#!/usr/bin/env bash

# NixOS Flake Configuration Pre-Push Hook
# This hook runs nix flake check before pushing to ensure
# the configuration has no syntax or type errors

set -euo pipefail

echo "üîç Running NixOS flake check..."
echo "----------------------------------------"

# Check if we're in a directory with a flake
if [ ! -f "flake.nix" ]; then
    echo "‚ö†Ô∏è  Warning: No flake.nix found. Skipping check."
    exit 0
fi

# Run flake check to validate the configuration
if nix flake check --no-warn-dirty; then
    echo "----------------------------------------"
    echo "‚úÖ NixOS flake configuration is valid!"
    echo "‚úÖ Push allowed."
    exit 0
else
    echo "----------------------------------------"
    echo "‚ùå NixOS flake configuration has errors!"
    echo "‚ùå Push blocked. Please fix the errors before pushing."
    exit 1
fi
